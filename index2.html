<script src="cordova.js" type="text/javascript"></script>
    <script src="js/lib/jquery-1.11.1.min.js" type="text/javascript"></script>
<body>


<script>
function startAudioRec() {
  alert("Empiezo a grabar");
  var src = "recdos.amr"; //ESTE ARCHIVO LO GUARDA EN EL DEVICE STORAGE
  window.audioRec = new Media(src, recordOnSuccess, recordOnError);
  window.audioRec.startRecord();
  //circleBlink();
  alert("test");
}
function recordOnError() { alert("Audio Error");}
function recordOnSuccess() { alert("Audio Genial");
window.audioRec.release();
uploadFile();
}

var visible = true;
var recInterval;

function stopAudioRec() {
  window.audioRec.stopRecord();
  //clearInterval(window.recInterval);
  //document.getElementById("recCircle").setAttribute("style", "visibility: hidden;");
  //alert("ubicacion:"+window.audioRec.fullPath + "nombre:"+window.audioRec.name);
				//uploadFile(window.audioRec.fullPath, window.audioRec.name);
  //window.audioRec.release();
  ///YO INTENTE DESDE ACÁ UPLOADEAR EL ARCHIVO
}
function uploadFile(camino,nombre) {
	//var filepath = Environment.getExternalStorageDirectory().getPath();     
    //file = new File(filepath," ");        
	//var src=file.getAbsolutePath()+"recdos.amr";
		alert("Manda archivo");
		//alert("ubicacion:"+camino);
		//mediaFile.play();
		//alert("reproduce archivo");
        var ft = new FileTransfer(),
            path = "recdos.amr",
            name = "recdos.amr";

        ft.upload(path,
            "http://www.swci.com.ar/audio/upload.php", ///ACÁ va el php
            function(result) {
                alert('Upload success: ' + result.responseCode);
                alert(result.bytesSent + ' bytes sent');
				window.audioRec.release();
            },
            function(error) {
                alert('Error uploading file ' + path + ': ' + error.code);
            },
            { fileName: name });
    }
function buscar(){
	//alert("entro en buscar");
	//var filepath = Environment.getExternalStorageDirectory().getPath();             
    //var src=file.getAbsolutePath()+"recdos.amr"; 
	//alert("Manda archivo desde: "+src);
	//alert("pruebo si existe dir larga");
	//checkIfFileExists(src);
	alert("pruebo si existe la corta");
	checkIfFileExists("recdos.amr");
		//alert("ubicacion:"+camino);
		//mediaFile.play();
		//alert("reproduce archivo");
}
function sendFile(src) {
            var options = new FileUploadOptions();
			options.fileKey = "audio";
			options.fileName = src.substr(src.lastIndexOf('/') + 1);
			options.mimeType = "audio/AMR";
			options.httpMethod = "POST";
			options.chunkedMode = false;

            var params = {};
            params.value1 = "test";
            params.value2 = "param";

            options.params = params;

            var ft = new FileTransfer();
            ft.upload(src, encodeURI("http://www.swci.com.ar/audio/upload.php"), win, fail, options);
        }

        function win(r) {
			alert("Se mando");
            alert("Code = " + r.responseCode);
            alert("Response = " + r.response);
            alert("Sent = " + r.bytesSent);
        }

        function fail(error) {
            alert("An error has occurred: Code = " + error.code);
            alert("upload error source " + error.source);
            alert("upload error target " + error.target);
        }
function checkIfFileExists(path){
    window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, function(fileSystem){
        fileSystem.root.getFile(path, { create: false }, fileExists, fileDoesNotExist);
    }, getFSFail); //of requestFileSystem
}
function fileExists(fileEntry){
    alert("File " + fileEntry.fullPath + " exists! Te lo mando al server");
	alert("Lo que le tiene que pasar para uploadear es esto: "+fileEntry.toURL());
	sendFile(fileEntry.toURL());
}
function fileDoesNotExist(){
    alert("file does not exist");
}
function getFSFail(evt) {
    alert(evt.target.error.code);
}
</script>
<button onClick="startAudioRec()">Start</button>
<button onClick="stopAudioRec()">Stop</button>
<button onClick="buscar()">Mandar</button>
</body>